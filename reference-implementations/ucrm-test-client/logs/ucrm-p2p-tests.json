[
  {
    "type": "startUcrm",
    "desc": "start UCRM A",
    "ucrmId": "ucrmA",
    "startDir": "../ucrm/express-js",
    "startCmd": "node",
    "startCmdParms": [
      "main.js",
      "./config/a.config.js"
    ],
    "baseUrl": "http://localhost:3002/ucrm/client/v0",
    "readyLogString": "Listening on port",
    "logStdOut": false,
    "logStdErr": false,
    "ready": true,
    "durationMs": 1105
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (userA1)",
    "ucrmId": "ucrmA",
    "username": "userA1",
    "password": "test",
    "expect": {
      "http": 200
    },
    "durationMs": 132
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get info while p2p discovery is active (status must be 1)",
    "endpoint": "info",
    "method": "GET",
    "durationMs": 10
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get registry entries while p2p discovery is active (should be 3)",
    "endpoint": "registry",
    "method": "GET",
    "durationMs": 10
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (p2p user ucrmB on ucrmA)",
    "ucrmId": "ucrmA",
    "baseUrlOverride": "http://localhost:3002/ucrm/p2p/v0",
    "username": "crmB",
    "password": "test",
    "expect": {
      "http": 200
    },
    "durationMs": 12
  },
  {
    "type": "startUcrm",
    "desc": "start UCRM B",
    "ucrmId": "ucrmB",
    "startDir": "../ucrm/express-js",
    "startCmd": "node",
    "startCmdParms": [
      "main.js",
      "./config/b.config.js"
    ],
    "baseUrl": "http://localhost:3003/ucrm/client/v0",
    "readyLogString": "Listening on port",
    "logStdOut": false,
    "logStdErr": false,
    "ready": true,
    "durationMs": 1099
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (userB1)",
    "ucrmId": "ucrmB",
    "username": "userB",
    "password": "test",
    "expect": {
      "http": 200
    },
    "durationMs": 203
  },
  {
    "type": "awaitDiscoveryComplete",
    "ucrmId": "ucrmA",
    "username": "userA1",
    "durationMs": 2064
  },
  {
    "type": "awaitDiscoveryComplete",
    "ucrmId": "ucrmB",
    "username": "userB",
    "durationMs": 523
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get registry entries after p2p discovery is complete (should be 5)",
    "endpoint": "registry",
    "method": "GET",
    "durationMs": 7
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "crmB",
    "baseUrlOverride": "http://localhost:3002/ucrm/p2p/v0",
    "desc": "get local registry entries after p2p discovery is complete (should be 3)",
    "endpoint": "registry",
    "method": "GET",
    "durationMs": 4
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send first message (valid message)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 20,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "1.0",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.NTRkNWJmZTk5ZDRiY2IzODVjYzMyYjIyMmQ0OTFmMzQyN2E2N2YxYzUxODBmZjlmMzU3ODRhMDUyM2ZmZjM3MQ.GvurAKvK7yowIcucDGZsYrQmGxl2oQqvXVQExNhBCvjddojIjvdJblkCLNtczVoD7ihoyIBQjyj0hzUw9pCf6Mov2bkdnfCByZL0rUy3A-jj3QAOcLHZM2XZozcCMD-pxmTzGysXKPcZX6BD5rxTKwHAZ7d5CkwVNvlcntWAj8vQzvflRX690ZtDN3Hpi_B3AnBwxx1nojW9RflOKBVCZ3zgK5LFItEZD6TTYCuxMmw5KO48lw0TWHwPfWKClBeyx9EirLwhkvMVmsefbTy5p5K5HWt1W3Y9kBDYZ2d6t6v45KN3Ep_cpkzleoXlYiMMwqTP1pGTW213eHQAFxpgDQ"
    },
    "endpoint": "messaging/send",
    "method": "POST",
    "durationMs": 15
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first message",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5,
      "maxDelay": 10
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 95
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send second message (valid message)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 20,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "1.0",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.NTRkNWJmZTk5ZDRiY2IzODVjYzMyYjIyMmQ0OTFmMzQyN2E2N2YxYzUxODBmZjlmMzU3ODRhMDUyM2ZmZjM3MQ.GvurAKvK7yowIcucDGZsYrQmGxl2oQqvXVQExNhBCvjddojIjvdJblkCLNtczVoD7ihoyIBQjyj0hzUw9pCf6Mov2bkdnfCByZL0rUy3A-jj3QAOcLHZM2XZozcCMD-pxmTzGysXKPcZX6BD5rxTKwHAZ7d5CkwVNvlcntWAj8vQzvflRX690ZtDN3Hpi_B3AnBwxx1nojW9RflOKBVCZ3zgK5LFItEZD6TTYCuxMmw5KO48lw0TWHwPfWKClBeyx9EirLwhkvMVmsefbTy5p5K5HWt1W3Y9kBDYZ2d6t6v45KN3Ep_cpkzleoXlYiMMwqTP1pGTW213eHQAFxpgDQ"
    },
    "endpoint": "messaging/send",
    "method": "POST",
    "durationMs": 6
  },
  {
    "type": "sleep",
    "durationMs": 2003
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first and second message",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5,
      "maxDelay": 0
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 8
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first message (maxMessages=1)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 1,
      "maxDelay": 0
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 6
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging commit first message",
    "body": {
      "destination": "1.2.3.4.5.7",
      "sequenceId": 1
    },
    "endpoint": "messaging/commit",
    "method": "POST",
    "durationMs": 6
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive second message (first was already committed)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5,
      "maxDelay": 0
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 4
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging commit second message",
    "body": {
      "destination": "1.2.3.4.5.7",
      "sequenceId": 2
    },
    "endpoint": "messaging/commit",
    "method": "POST",
    "durationMs": 3
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive no messages (first and second was already committed)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5,
      "maxDelay": 0
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 2
  },
  {
    "type": "sleep",
    "durationMs": 2002
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging receive two delivery success messages",
    "body": {
      "destinations": [
        "1.2.3.4.5.6"
      ],
      "maxMessages": 5,
      "maxDelay": 0
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 16
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "commit both delivery success messages",
    "body": {
      "destination": "1.2.3.4.5.6",
      "sequenceId": 2
    },
    "endpoint": "messaging/commit",
    "method": "POST",
    "durationMs": 5
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send (correct message with ACK=ALL and 5sec timeout)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 10,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "1.0",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.NTRkNWJmZTk5ZDRiY2IzODVjYzMyYjIyMmQ0OTFmMzQyN2E2N2YxYzUxODBmZjlmMzU3ODRhMDUyM2ZmZjM3MQ.GvurAKvK7yowIcucDGZsYrQmGxl2oQqvXVQExNhBCvjddojIjvdJblkCLNtczVoD7ihoyIBQjyj0hzUw9pCf6Mov2bkdnfCByZL0rUy3A-jj3QAOcLHZM2XZozcCMD-pxmTzGysXKPcZX6BD5rxTKwHAZ7d5CkwVNvlcntWAj8vQzvflRX690ZtDN3Hpi_B3AnBwxx1nojW9RflOKBVCZ3zgK5LFItEZD6TTYCuxMmw5KO48lw0TWHwPfWKClBeyx9EirLwhkvMVmsefbTy5p5K5HWt1W3Y9kBDYZ2d6t6v45KN3Ep_cpkzleoXlYiMMwqTP1pGTW213eHQAFxpgDQ"
    },
    "endpoint": "messaging/send",
    "method": "POST",
    "durationMs": 4
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging receive one delivery timeout message",
    "body": {
      "destinations": [
        "1.2.3.4.5.6"
      ],
      "maxMessages": 5,
      "maxDelay": 13
    },
    "endpoint": "messaging/receive",
    "method": "POST",
    "durationMs": 10874
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "commit one delivery timeout message",
    "body": {
      "destination": "1.2.3.4.5.6",
      "sequenceId": 3
    },
    "endpoint": "messaging/commit",
    "method": "POST",
    "durationMs": 4
  }
]