[
  {
    "type": "startUcrm",
    "desc": "start UCRM A",
    "ucrmId": "ucrmA",
    "startDir": "../ucrm/express-js",
    "startCmd": "node",
    "startCmdParms": [
      "main.js",
      "./config/a.config.js"
    ],
    "baseUrl": "http://localhost:3002/ucrm/client/v0",
    "readyLogString": "Listening on port",
    "logStdOut": false,
    "logStdErr": false,
    "ready": true
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (userA1)",
    "ucrmId": "ucrmA",
    "username": "userA1",
    "password": "test",
    "expect": {
      "http": 200
    }
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get info while p2p discovery is active (status must be 1)",
    "endpoint": "info",
    "method": "GET"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get registry entries while p2p discovery is active (should be 3)",
    "endpoint": "registry",
    "method": "GET"
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (p2p user ucrmB on ucrmA)",
    "ucrmId": "ucrmA",
    "baseUrlOverride": "http://localhost:3002/ucrm/p2p/v0",
    "username": "crmB",
    "password": "test",
    "expect": {
      "http": 200
    }
  },
  {
    "type": "startUcrm",
    "desc": "start UCRM B",
    "ucrmId": "ucrmB",
    "startDir": "../ucrm/express-js",
    "startCmd": "node",
    "startCmdParms": [
      "main.js",
      "./config/b.config.js"
    ],
    "baseUrl": "http://localhost:3003/ucrm/client/v0",
    "readyLogString": "Listening on port",
    "logStdOut": false,
    "logStdErr": false,
    "ready": true
  },
  {
    "type": "authorize",
    "desc": "authorize with correct credentials (userB1)",
    "ucrmId": "ucrmB",
    "username": "userB",
    "password": "test",
    "expect": {
      "http": 200
    }
  },
  {
    "type": "awaitDiscoveryComplete",
    "ucrmId": "ucrmA",
    "username": "userA1"
  },
  {
    "type": "awaitDiscoveryComplete",
    "ucrmId": "ucrmB",
    "username": "userB"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "get registry entries after p2p discovery is complete (should be 5)",
    "endpoint": "registry",
    "method": "GET"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "crmB",
    "baseUrlOverride": "http://localhost:3002/ucrm/p2p/v0",
    "desc": "get local registry entries after p2p discovery is complete (should be 3)",
    "endpoint": "registry",
    "method": "GET"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send first message (valid message)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 20,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "0.1",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.ZTRiMjZiN2RkY2UxNWUwNmM5YTBjN2I4NDgyYmM4YWMyNmFlY2VhYWVlMWExN2YyM2RjMzJiODhiZDIwOWVmMg.ElOJVBoRbiHHahocGtgSiNQSBstWGeu63Hhe1-XqTvVBDsK1qJI_tiJaIG6Mx40kzEWJWMVUIQAPfJGxJSf_xM-oOdrDwS3Wpl3KWx9ELKmN-XCllJ0txdnJYnzYkVCGJxFWEikskM-5Ze3uRUnU-IqJEp5z3OJuXEcL3Qre3uEtd8-I0ezbcJmvi59Jvk89fkfigl9SpJs_MeEFX_tnkwsWcKJZa-4Jd2ovW7h3FQOU7ItytjC3cpzxAp0lljKOky4LRzxtLLeNMPYo2O5MUziW1bW9JOTaQys4rKO6N8lIyXCnPuRg4fX4tMgeO5DkuprpUR1CN0Q2a1iqNMxpCA"
    },
    "endpoint": "messaging/send",
    "method": "POST"
  },
  {
    "type": "sleep",
    "durationMs": 2000
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first message",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send second message (valid message)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 20,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "0.1",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.ZTRiMjZiN2RkY2UxNWUwNmM5YTBjN2I4NDgyYmM4YWMyNmFlY2VhYWVlMWExN2YyM2RjMzJiODhiZDIwOWVmMg.ElOJVBoRbiHHahocGtgSiNQSBstWGeu63Hhe1-XqTvVBDsK1qJI_tiJaIG6Mx40kzEWJWMVUIQAPfJGxJSf_xM-oOdrDwS3Wpl3KWx9ELKmN-XCllJ0txdnJYnzYkVCGJxFWEikskM-5Ze3uRUnU-IqJEp5z3OJuXEcL3Qre3uEtd8-I0ezbcJmvi59Jvk89fkfigl9SpJs_MeEFX_tnkwsWcKJZa-4Jd2ovW7h3FQOU7ItytjC3cpzxAp0lljKOky4LRzxtLLeNMPYo2O5MUziW1bW9JOTaQys4rKO6N8lIyXCnPuRg4fX4tMgeO5DkuprpUR1CN0Q2a1iqNMxpCA"
    },
    "endpoint": "messaging/send",
    "method": "POST"
  },
  {
    "type": "sleep",
    "durationMs": 2000
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first and second message",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive first message (maxMessages=1)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 1
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging commit first message",
    "body": {
      "destination": "1.2.3.4.5.7",
      "sequenceId": 1
    },
    "endpoint": "messaging/commit",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive second message (first was already committed)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging commit second message",
    "body": {
      "destination": "1.2.3.4.5.7",
      "sequenceId": 2
    },
    "endpoint": "messaging/commit",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmB",
    "username": "userB",
    "desc": "post messaging receive no messages (first and second was already committed)",
    "body": {
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "sleep",
    "durationMs": 2000
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging receive two delivery success messages",
    "body": {
      "destinations": [
        "1.2.3.4.5.6"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "commit both delivery success messages",
    "body": {
      "destination": "1.2.3.4.5.6",
      "sequenceId": 2
    },
    "endpoint": "messaging/commit",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging send (correct message with ACK=ALL and 5sec timeout)",
    "body": {
      "description": "Einsatzübergabe am 13.11.2023 um 20:20",
      "timeout": 10,
      "ack": "ALL",
      "source": "1.2.3.4.5.6",
      "destinations": [
        "1.2.3.4.5.7"
      ],
      "payload": {
        "appId": "incident_transfer",
        "appVersion": "0.1",
        "schemaId": "incident",
        "contentType": "application/json",
        "data": "{\"sharedIncidentId\":\"550e8400-e29b-41d4-a716-446655440000\",\"internalId\":\"f123456\",\"classifications\":[\"A1\",\"F2\"],\"issue\":\"Notfall\",\"flashingLights\":true,\"additionalInformation\":\"Zusatzinformationen\",\"sentByDispatcherAt\":\"2024-01-01T10:05:08Z\",\"startTimestamp\":\"2024-01-01T09:55:15Z\",\"missionLocation\":{\"coordinate\":{\"lat\":65.453323,\"lon\":14.542343},\"address\":{\"street\":\"Musterstrasse\",\"houseNumber\":\"15b\",\"postalCode\":\"12345\",\"city\":\"Musterhausen\",\"cityDistrict\":\"Musterberg\",\"state\":\"Brandenburg\",\"country\":\"DE\"},\"object\":{\"name\":\"Abteilung IV, Haus 3\",\"additionalInformation\":\"Campus West\"},\"superiorObject\":{\"name\":\"Krankenhaus Musterstift\",\"additionalInformation\":\"Weitere Informationen\"},\"floor\":\"3. OG\",\"room\":\"412\",\"additionalInformation\":\"Weitere Informationen\"},\"informers\":[{\"name\":\"Musterfrau\",\"surname\":\"Heike\",\"phone\":\"+49 30 234567\",\"email\":\"heike.musterfrau@example.com\"}]}"
      },
      "signature": "eyJ0eXAiOiJVQ1JJX1BMQUlOIiwiYWxnIjoiUlMyNTYifQ.ZTRiMjZiN2RkY2UxNWUwNmM5YTBjN2I4NDgyYmM4YWMyNmFlY2VhYWVlMWExN2YyM2RjMzJiODhiZDIwOWVmMg.ElOJVBoRbiHHahocGtgSiNQSBstWGeu63Hhe1-XqTvVBDsK1qJI_tiJaIG6Mx40kzEWJWMVUIQAPfJGxJSf_xM-oOdrDwS3Wpl3KWx9ELKmN-XCllJ0txdnJYnzYkVCGJxFWEikskM-5Ze3uRUnU-IqJEp5z3OJuXEcL3Qre3uEtd8-I0ezbcJmvi59Jvk89fkfigl9SpJs_MeEFX_tnkwsWcKJZa-4Jd2ovW7h3FQOU7ItytjC3cpzxAp0lljKOky4LRzxtLLeNMPYo2O5MUziW1bW9JOTaQys4rKO6N8lIyXCnPuRg4fX4tMgeO5DkuprpUR1CN0Q2a1iqNMxpCA"
    },
    "endpoint": "messaging/send",
    "method": "POST"
  },
  {
    "type": "sleep",
    "durationMs": 12500
  },
  {
    "type": "fetch",
    "expect": {
      "http": 200
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "post messaging receive one delivery timeout message",
    "body": {
      "destinations": [
        "1.2.3.4.5.6"
      ],
      "maxMessages": 5
    },
    "endpoint": "messaging/receive",
    "method": "POST"
  },
  {
    "type": "fetch",
    "expect": {
      "http": 204
    },
    "ucrmId": "ucrmA",
    "username": "userA1",
    "desc": "commit one delivery timeout message",
    "body": {
      "destination": "1.2.3.4.5.6",
      "sequenceId": 3
    },
    "endpoint": "messaging/commit",
    "method": "POST"
  }
]